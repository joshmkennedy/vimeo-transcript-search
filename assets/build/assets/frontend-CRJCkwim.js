var m=Object.defineProperty;var d=(i,e,t)=>e in i?m(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>d(i,typeof e!="symbol"?e+"":e,t);import{c as p,j as s,r as l,O as u,V as h,P as f}from"./player.es-BRvXE_F-.js";function g({player:i,vimeoId:e,times:t,toastMessage:a}){const o=l.useRef(!1);return console.log("re-rendered"),l.useEffect(()=>{i.on("timeupdate",n=>{Math.round(n.seconds)>=t.end&&(o==null?void 0:o.current)==!1&&(o.current=!0,w(a))})},[i,t]),l.useEffect(()=>{},[]),s.jsx("div",{children:s.jsx(u,{containerStyle:{top:"100px"},toastOptions:{className:"toast-toast"}})})}function y(i,e){p.createRoot(i).render(s.jsx(g,{...e}))}function w(i){h(()=>typeof i!="string"?s.jsxs("div",{className:"toast-content",children:[s.jsx("div",{className:"toast-heading",children:i.heading}),s.jsx("div",{className:"toast-text",children:i.message})]}):s.jsx("div",{className:"toast-content",children:i}),{icon:"ðŸŽ‰",duration:5e3})}class v{constructor(){r(this,"loaded",!1);r(this,"vimeoId");r(this,"player");r(this,"startTime");r(this,"endTime")}shouldUse(){const e=this.getVimeoId();return e?document.querySelector(`iframe[src*='${e}']`)?!0:(console.log("no iframe found"),!1):(console.log("no vimeo clip param"),!1)}init(){console.log("Starting the skip to clip plugin"),this.loadPlayer(this.vimeoId)}loadPlayer(e){if(this.player)return console.log("player already loaded"),this.player;{const t=document.querySelector(`iframe[src*='${e}']`);this.player=new f(t),console.log("loading player",this.player),this.player.on("loaded",()=>{this.loaded=!0,this.startPlugin()})}}async startPlugin(){if(!this.loaded)throw new Error("Vimeo Plugin has not been properly loaded, need to call loadPlayer before startPlugin");await this.setTimes(),this.mountApp()}async setTimes(){const e=new URLSearchParams(window.location.search),t=e.has("start")?"start":"ts",a=e.has("end")?"end":"end-ts";if(!e.has(t)&&!e.has(a)){console.log("no start or end param");return}const o=parseInt(e.get(t)??"0"),n=parseInt(e.get(a)??"0");this.startTime=o,this.endTime=n;let c=setTimeout(async()=>{console.log("setting start time again"),await this.setCurrentTime(o)},2e3);await this.setCurrentTime(o),clearTimeout(c)}async setCurrentTime(e){await this.player.setCurrentTime(e).catch(console.error)}mountApp(){const e=document.createElement("div");e.id="aim-clip-player-app";const a=document.querySelector(`iframe[src*='${this.vimeoId}']`).closest(".wp-block-embed");if(!a)throw new Error("Could not find wrapper element");a.appendChild(e);const o={heading:"You have completed the currated clip!",message:"Keep watching to go deeper and learn more about this topic."};y(e,{player:this.player,vimeoId:this.vimeoId,times:{start:this.startTime??0,end:this.endTime??-1},toastMessage:o})}getVimeoId(){var t;if(this.vimeoId)return this.vimeoId;if(window.vtsPublic.aimClip)return this.vimeoId=window.vtsPublic.aimClip,this.vimeoId;const e=new URLSearchParams(window.location.search);if(e.has(this.vimeoClipParamKey(e)))return this.vimeoId=(t=e.get(this.vimeoClipParamKey(e)))==null?void 0:t.toString(),this.vimeoId}vimeoClipParamKey(e){return e.has("aim-clip")?"aim-clip":"skip-to-clip-video"}}window.aimVimeoPlugins||(window.aimVimeoPlugins=[]);window.aimVimeoPlugins.push({aimClipPlayer:new v});
