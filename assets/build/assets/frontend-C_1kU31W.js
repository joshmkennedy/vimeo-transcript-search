var D=Object.defineProperty;var b=e=>{throw TypeError(e)};var R=(e,t,i)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var u=(e,t,i)=>R(e,typeof t!="symbol"?t+"":t,i),S=(e,t,i)=>t.has(e)||b("Cannot "+i);var E=(e,t,i)=>t.has(e)?b("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);var P=(e,t,i)=>(S(e,t,"access private method"),i);import{j as s,a as T,f as x,c as M,r as p,O as F,V as O,P as A}from"./format-time-B3FwRNDL.js";/*! js-cookie v3.0.5 | MIT */function g(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)e[r]=i[r]}return e}var U={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function j(e,t){function i(n,c,o){if(!(typeof document>"u")){o=g({},t,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,o[l]!==!0&&(a+="="+o[l].split(";")[0]));return document.cookie=n+"="+e.write(c,n)+a}}function r(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var c=document.cookie?document.cookie.split("; "):[],o={},a=0;a<c.length;a++){var l=c[a].split("="),y=l.slice(1).join("=");try{var m=decodeURIComponent(l[0]);if(o[m]=e.read(y,m),n===m)break}catch{}}return n?o[n]:o}}return Object.create({set:i,get:r,remove:function(n,c){i(n,"",g({},c,{expires:-1}))},withAttributes:function(n){return j(this.converter,g({},this.attributes,n))},withConverter:function(n){return j(g({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var _=j(U,{path:"/"});const C="vts-flash--";function B(){window.addEventListener("DOMContentLoaded",q)}function q(){const e=$();e&&e.length&&Array.isArray(e)&&(H(),e.forEach(z))}function $(){return document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith(C)).map(e=>e.replace(C,"").split("=")).map(e=>({id:e[0],message:e[1]}))}function z({message:e,id:t}){if(!e||!t)return;const i=document.createElement("div");i.classList.add("vts-flash-message"),i.setAttribute("data-vts-flash-message-id",t),i.innerHTML=`
  <button class="dismiss">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
  </button>
  <p>${decodeURIComponent(e)}</p>
  `;const r=document.querySelector("#vts-flash-messages");r&&(r.appendChild(i),_.remove(X(t)))}function H(){let e=document.querySelector("#vts-flash-messages");e||(e=document.createElement("div"),e.id="vts-flash-messages",W(e)),document.body.appendChild(e)}function W(e){e.addEventListener("click",G),e.addEventListener("animationend",K)}function G(e){const t=e.target;if(t.classList.contains("dismiss")){const i=t.closest(".vts-flash-message");i&&i.classList.add("vts-flash-message-leave")}}function K(e){const t=e.target;if(t.classList.contains("vts-flash-message-leave")){const i=t.closest(".vts-flash-message.vts-flash-message-leave");i&&i.remove()}}function X(e){return`${C}${e}`}const w={featured:{label:"Featured Lesson",singleLabel:"Featured Lesson",key:"featured",description:"Core concepts and initial set up to get you started"},supporting:{label:"Supporting Lessons",singleLabel:"Supporting Lesson",key:"supporting",description:"Go further with the these concepts and how to use them"}},V={lecture:w.featured,"secondary-lecture":w.supporting,lab:w.supporting};function Y(e){return e.reduce((i,r)=>{const n=V[r.video_type];return n.key in i?i[n.key].videos.push(r):i[n.key]={...n,videos:[r]},i},{})}function N(){var r;const e=document.querySelector("#aim-clip-player-app"),t=e==null?void 0:e.closest(".wp-block-embed");if(!t)throw new Error("Bad Dom Tree: Could not find app root's root, looking for closest .wp-block-embed");let i=(r=t.parentElement)==null?void 0:r.querySelector(".aim-clip-player--above-the-player");return i||(i=document.createElement("div"),i.classList.add("aim-clip-player--above-the-player"),t.insertAdjacentElement("beforebegin",i)),i}function J({children:e}){const t=N();return s.jsx(s.Fragment,{children:T.createPortal(e,t,"aboveVideoPlayer__portal")})}function Q(){N().scrollIntoView({behavior:"smooth",block:"start"})}function Z({selectedVideo:e,setSelectedVideo:t,videos:i}){const r=Y(i);function n(c){t(c),Q()}return s.jsxs("div",{className:"aim-video-selection section",children:[s.jsxs("header",{className:"section-header",children:[s.jsx("h3",{className:"video-selector-title",children:"Videos"}),s.jsx("p",{children:"Select a video to watch"})]}),Object.entries(r).map(([c,o])=>s.jsxs("div",{className:"video-selector-video-type-section",children:[s.jsxs("header",{className:"video-section__header",children:[s.jsx("h4",{children:o.label}),s.jsx("p",{children:o.description})]}),s.jsx("div",{className:"aim-video-selection-list",children:o.videos.map(a=>s.jsxs("div",{className:"aim-video-selection-item hoverable "+(a.clipId===e.clipId?"aim-video-selection-item-selected":""),onClick:()=>n(a.clipId),children:[e.clipId===a.clipId?s.jsx("div",{className:"aim-video-selection-item-selected-indicator",children:"selected"}):null,s.jsx("div",{className:"aim-video-selection-item-image",children:s.jsx("img",{src:a.image_url,alt:a.name})}),s.jsx("div",{className:"aim-video-selection-item-text",children:s.jsxs("div",{className:"aim-video-selection-item-text-name",children:["From ",a.name]})}),s.jsxs("div",{className:"aim-video-selection-item-times",children:[s.jsxs("div",{className:"aim-video-selection-item-times-duration",children:["Duration: ",s.jsx("span",{className:"time",children:x(a.end-a.start)})]}),s.jsx("div",{className:"aim-video-selection-item-times-timestamps",children:s.jsxs("span",{className:"time",children:[x(a.start)," - ",x(a.end)]})})]}),s.jsx("div",{className:"aim-video-selection-item-footer",children:a.clipId!==e.clipId?s.jsx("button",{className:"aim-video-selection-item-footer-button",children:"Watch Clip"}):null})]},a.clipId))})]},c))]})}function ee({resources:e}){return s.jsxs("div",{className:"aim-resource-list-section section",children:[s.jsxs("header",{className:"section-header",children:[s.jsx("h3",{className:"video-selector-title",children:"Resources"}),s.jsx("p",{children:"Accompanying resources from the videos"})]}),s.jsx("div",{className:"aim-resource-list",children:e.map(t=>s.jsx("div",{children:s.jsx("a",{className:"hoverable",href:t.link,target:"_blank",rel:"noreferrer",children:s.jsx("span",{dangerouslySetInnerHTML:{__html:t.label}})})},t.link))})]})}function te(e){return V[e].singleLabel}function ie(e){return se[V[e].key]}const se={featured:{"--video-type-badge-color":"var(--brand-c-primary)","--video-type-badge-text-color":"var(--brand-c-light)"},supporting:{"--video-type-badge-color":"var(--slate-100)","--video-type-badge-text-color":"var(--brand-c-secondary)"}};function ne({videoType:e}){return s.jsx("div",{className:"aim-vimeo-plugin--video-type-badge",style:ie(e),children:te(e)})}function oe({playerApi:e,videos:t,resources:i,selectedVideo:r}){const[n,c]=p.useState(r),[o,a]=p.useState([]),l=p.useMemo(()=>t.length?t.find(d=>d.clipId===n):t[0],[t,n]),y=p.useCallback(d=>{a(f=>[...f,d])},[a]);function m(d){c(d);const f=t.find(L=>L.clipId===d);f&&e.setCurrentVideo(f)}const h=p.useCallback(d=>{o.includes(d.detail.clipId)||(y(d.detail.clipId),re())},[o]);return p.useEffect(()=>(e.getPlayerEl().addEventListener("finishedVideo",h),()=>{e.getPlayerEl().removeEventListener("finishedVideo",h)}),[h]),p.useEffect(()=>{l&&e.setCurrentVideo(l)},[]),s.jsxs("div",{children:[s.jsx(J,{children:l&&s.jsx(ne,{videoType:l.video_type})}),l&&s.jsx("p",{children:l.summary}),s.jsxs("div",{className:"",children:[l&&s.jsx(Z,{selectedVideo:l,setSelectedVideo:m,videos:t}),s.jsx(ee,{resources:i})]}),s.jsx(F,{containerStyle:{top:"100px"},toastOptions:{className:"toast-toast"}})]})}function ae(e,t){M.createRoot(e).render(s.jsx(oe,{...t}))}const k={heading:"You have completed the currated clip!",message:"Keep watching to go deeper and learn more about this topic."};function re(){O(()=>s.jsxs("div",{className:"toast-content",children:[s.jsx("div",{className:"toast-heading",children:k.heading}),s.jsx("div",{className:"toast-text",children:k.message})]}),{icon:"ðŸŽ‰",duration:5e3})}class le{constructor(){u(this,"loaded",!1);u(this,"playerApi")}shouldUse(){var t;return(t=window==null?void 0:window.aimVimeoPluginData)!=null&&t.AimClipPlayerData?"videos"in window.aimVimeoPluginData.AimClipPlayerData?!0:(console.error("no videos in window.aimVimeoPluginData.AimClipPlayerData"),!1):!1}init(){this.loadPlayer()}loadPlayer(){if(this.playerApi)return console.log("player already loaded"),this.playerApi;{const t=document.querySelector(".aim-clip-player iframe");if(!t)throw new Error("No iframe found");this.playerApi=new ce(t),this.loaded=!0,this.startPlugin()}}async startPlugin(){if(!this.loaded)throw new Error("Vimeo Plugin has not been properly loaded, need to call loadPlayer before startPlugin");this.mountApp()}mountApp(){var r,n;const t=document.createElement("div");t.id="aim-clip-player-app";const i=(n=(r=this.playerApi)==null?void 0:r.getPlayerEl())==null?void 0:n.closest(".wp-block-embed");if(!i)throw new Error("Could not find wrapper element");i.appendChild(t),ae(t,{playerApi:this.playerApi,intro:window.aimVimeoPluginData.AimClipPlayerData.intro,videos:window.aimVimeoPluginData.AimClipPlayerData.videos,selectedVideo:window.aimVimeoPluginData.AimClipPlayerData.selectedVideo,resources:window.aimVimeoPluginData.AimClipPlayerData.resources})}}var v,I;class ce{constructor(t){E(this,v);u(this,"player");u(this,"currentVideo");this.playerEl=t,this.player=new A(this.playerEl)}getPlayerEl(){return this.playerEl}async setCurrentVideo(t){const i=this.playerEl.parentElement;await this.player.destroy(),this.player.off("timeupdate"),i.prepend(this.playerEl),this.player=new A(this.playerEl),this.currentVideo=t,await this.player.loadVideo(this.currentVideo.vimeoId),await this.setCurrentTime(),P(this,v,I).call(this)}async setCurrentTime(){var t;await this.player.setCurrentTime(((t=this.currentVideo)==null?void 0:t.start)??0)}}v=new WeakSet,I=function(){setTimeout(()=>{this.player.on("timeupdate",t=>{this.currentVideo&&this.currentVideo.end<=t.seconds&&this.playerEl.dispatchEvent(new CustomEvent("finishedVideo",{detail:this.currentVideo}))})},100)};window.aimVimeoPlugins||(window.aimVimeoPlugins=[]);window.aimVimeoPlugins.push({aimClipPlayer:new le});B();
