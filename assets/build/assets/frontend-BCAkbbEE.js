var C=Object.defineProperty;var y=t=>{throw TypeError(t)};var A=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var r=(t,e,s)=>A(t,typeof e!="symbol"?e+"":e,s),I=(t,e,s)=>e.has(t)||y("Cannot "+s);var f=(t,e,s)=>e.has(t)?y("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s);var x=(t,e,s)=>(I(t,e,"access private method"),s);import{j as i,f as u,c as b,r as o,O as D,V as S,P as w}from"./format-time-qBXqTqcc.js";function k({selectedVideo:t,setSelectedVideo:e,videos:s}){return i.jsxs("div",{className:"aim-video-selection section",children:[i.jsxs("header",{className:"section-header",children:[i.jsx("h3",{className:"video-selector-title",children:"Videos"}),i.jsx("p",{children:"Select a video to watch"})]}),i.jsx("div",{className:"aim-video-selection-list",children:s.map(l=>i.jsxs("div",{className:"aim-video-selection-item hoverable "+(l.clipId===t.clipId?"aim-video-selection-item-selected":""),onClick:()=>e(l.clipId),children:[t.clipId===l.clipId?i.jsx("div",{className:"aim-video-selection-item-selected-indicator",children:"selected"}):null,i.jsx("div",{className:"aim-video-selection-item-image",children:i.jsx("img",{src:l.image_url,alt:l.name})}),i.jsx("div",{className:"aim-video-selection-item-text",children:i.jsxs("div",{className:"aim-video-selection-item-text-name",children:["From ",l.name]})}),i.jsxs("div",{className:"aim-video-selection-item-times",children:[i.jsxs("div",{className:"aim-video-selection-item-times-duration",children:["Duration: ",i.jsx("span",{className:"time",children:u(l.end-l.start)})]}),i.jsx("div",{className:"aim-video-selection-item-times-timestamps",children:i.jsxs("span",{className:"time",children:[u(l.start)," - ",u(l.end)]})})]}),i.jsx("div",{className:"aim-video-selection-item-footer",children:l.clipId!==t.clipId?i.jsx("button",{className:"aim-video-selection-item-footer-button",children:"Watch Clip"}):null})]},l.clipId))})]})}function T({resources:t}){return i.jsxs("div",{className:"aim-resource-list-section section",children:[i.jsxs("header",{className:"section-header",children:[i.jsx("h3",{className:"video-selector-title",children:"Resources"}),i.jsx("p",{children:"Accompanying resources from the videos"})]}),i.jsx("div",{className:"aim-resource-list",children:t.map(e=>i.jsx("div",{children:i.jsx("a",{className:"hoverable",href:e.link,target:"_blank",rel:"noreferrer",children:i.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})})},e.link))})]})}function L({playerApi:t,videos:e,resources:s,selectedVideo:l}){const[n,j]=o.useState(l),[p,g]=o.useState([]),d=o.useMemo(()=>e.length?e.find(a=>a.clipId===n):e[0],[e,n]);console.log("re-rendered",e,p.length);const P=o.useCallback(a=>{g(c=>[...c,a])},[g]);function N(a){j(a);const c=e.find(E=>E.clipId===a);c&&t.setCurrentVideo(c)}const h=o.useCallback(a=>{console.log("video finished",a.detail.clipId),!p.includes(a.detail.clipId)&&(P(a.detail.clipId),_())},[p]);return o.useEffect(()=>(console.log("adding event listener"),t.getPlayerEl().addEventListener("finishedVideo",h),()=>{console.log("removing event listener"),t.getPlayerEl().removeEventListener("finishedVideo",h)}),[h]),o.useEffect(()=>{d&&t.setCurrentVideo(d)},[]),i.jsxs("div",{children:[i.jsxs("div",{className:"",children:[d&&i.jsx(k,{selectedVideo:d,setSelectedVideo:N,videos:e}),i.jsx(T,{resources:s})]}),i.jsx(D,{containerStyle:{top:"100px"},toastOptions:{className:"toast-toast"}})]})}function R(t,e){b.createRoot(t).render(i.jsx(L,{...e}))}const v={heading:"You have completed the currated clip!",message:"Keep watching to go deeper and learn more about this topic."};function _(){S(()=>i.jsxs("div",{className:"toast-content",children:[i.jsx("div",{className:"toast-heading",children:v.heading}),i.jsx("div",{className:"toast-text",children:v.message})]}),{icon:"ðŸŽ‰",duration:5e3})}class F{constructor(){r(this,"loaded",!1);r(this,"playerApi")}shouldUse(){var e;return(e=window==null?void 0:window.aimVimeoPluginData)!=null&&e.AimClipPlayerData?"videos"in window.aimVimeoPluginData.AimClipPlayerData?!0:(console.error("no videos in window.aimVimeoPluginData.AimClipPlayerData"),!1):!1}init(){console.log("Starting the skip to clip plugin"),this.loadPlayer()}loadPlayer(){if(this.playerApi)return console.log("player already loaded"),this.playerApi;{const e=document.querySelector(".aim-clip-player iframe");if(!e)throw new Error("No iframe found");this.playerApi=new M(e),this.loaded=!0,this.startPlugin()}}async startPlugin(){if(!this.loaded)throw new Error("Vimeo Plugin has not been properly loaded, need to call loadPlayer before startPlugin");console.log("trying to mount app"),this.mountApp()}mountApp(){var l,n;const e=document.createElement("div");e.id="aim-clip-player-app";const s=(n=(l=this.playerApi)==null?void 0:l.getPlayerEl())==null?void 0:n.closest(".wp-block-embed");if(!s)throw new Error("Could not find wrapper element");s.appendChild(e),console.log("App is now mounting"),R(e,{playerApi:this.playerApi,videos:window.aimVimeoPluginData.AimClipPlayerData.videos,selectedVideo:window.aimVimeoPluginData.AimClipPlayerData.selectedVideo,resources:window.aimVimeoPluginData.AimClipPlayerData.resources})}}var m,V;class M{constructor(e){f(this,m);r(this,"player");r(this,"currentVideo");this.playerEl=e,this.player=new w(this.playerEl)}getPlayerEl(){return this.playerEl}async setCurrentVideo(e){console.log("setting current video",e.clipId);const s=this.playerEl.parentElement;await this.player.destroy(),this.player.off("timeupdate"),console.log("destroyed player"),s.prepend(this.playerEl),this.player=new w(this.playerEl),console.log("created new player"),this.currentVideo=e,await this.player.loadVideo(this.currentVideo.vimeoId),console.log("loaded video",this.currentVideo.vimeoId),console.log("player loaded",this),await this.setCurrentTime(),x(this,m,V).call(this)}async setCurrentTime(){var e;await this.player.setCurrentTime(((e=this.currentVideo)==null?void 0:e.start)??0)}}m=new WeakSet,V=function(){console.log("adding timeupdate listener"),setTimeout(()=>{console.log("adding timeupdate listener",this.player),this.player.on("timeupdate",e=>{console.log("timeupdate",e),this.currentVideo&&this.currentVideo.end<=e.seconds&&this.playerEl.dispatchEvent(new CustomEvent("finishedVideo",{detail:this.currentVideo}))})},100)};window.aimVimeoPlugins||(window.aimVimeoPlugins=[]);window.aimVimeoPlugins.push({aimClipPlayer:new F});
