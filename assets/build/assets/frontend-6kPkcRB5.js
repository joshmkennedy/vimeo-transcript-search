var D=Object.defineProperty;var C=e=>{throw TypeError(e)};var k=(e,i,t)=>i in e?D(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var u=(e,i,t)=>k(e,typeof i!="symbol"?i+"":i,t),L=(e,i,t)=>i.has(e)||C("Cannot "+t);var V=(e,i,t)=>i.has(e)?C("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,t);var E=(e,i,t)=>(L(e,i,"access private method"),t);import{j as s,f as x,c as R,r as m,O as b,V as M,P}from"./format-time-qBXqTqcc.js";/*! js-cookie v3.0.5 | MIT */function v(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)e[n]=t[n]}return e}var S={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function w(e,i){function t(a,d,r){if(!(typeof document>"u")){r=v({},i,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var o in r)r[o]&&(l+="; "+o,r[o]!==!0&&(l+="="+r[o].split(";")[0]));return document.cookie=a+"="+e.write(d,a)+l}}function n(a){if(!(typeof document>"u"||arguments.length&&!a)){for(var d=document.cookie?document.cookie.split("; "):[],r={},l=0;l<d.length;l++){var o=d[l].split("="),y=o.slice(1).join("=");try{var p=decodeURIComponent(o[0]);if(r[p]=e.read(y,p),a===p)break}catch{}}return a?r[a]:r}}return Object.create({set:t,get:n,remove:function(a,d){t(a,"",v({},d,{expires:-1}))},withAttributes:function(a){return w(this.converter,v({},this.attributes,a))},withConverter:function(a){return w(v({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(e)}})}var F=w(S,{path:"/"});const j="vts-flash--";function T(){window.addEventListener("DOMContentLoaded",U)}function U(){const e=O();e&&e.length&&Array.isArray(e)&&(_(),e.forEach(B))}function O(){return document.cookie.split(";").map(e=>e.trim()).filter(e=>e.startsWith(j)).map(e=>e.replace(j,"").split("=")).map(e=>({id:e[0],message:e[1]}))}function B({message:e,id:i}){if(!e||!i)return;const t=document.createElement("div");t.classList.add("vts-flash-message"),t.setAttribute("data-vts-flash-message-id",i),t.innerHTML=`
  <button class="dismiss">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
  </button>
  <p>${decodeURIComponent(e)}</p>
  `;const n=document.querySelector("#vts-flash-messages");n&&(n.appendChild(t),F.remove(H(i)))}function _(){let e=document.querySelector("#vts-flash-messages");e||(e=document.createElement("div"),e.id="vts-flash-messages",$(e)),document.body.appendChild(e)}function $(e){e.addEventListener("click",q),e.addEventListener("animationend",z)}function q(e){const i=e.target;if(i.classList.contains("dismiss")){const t=i.closest(".vts-flash-message");t&&t.classList.add("vts-flash-message-leave")}}function z(e){const i=e.target;if(i.classList.contains("vts-flash-message-leave")){const t=i.closest(".vts-flash-message.vts-flash-message-leave");t&&t.remove()}}function H(e){return`${j}${e}`}function W({selectedVideo:e,setSelectedVideo:i,videos:t}){return s.jsxs("div",{className:"aim-video-selection section",children:[s.jsxs("header",{className:"section-header",children:[s.jsx("h3",{className:"video-selector-title",children:"Videos"}),s.jsx("p",{children:"Select a video to watch"})]}),s.jsx("div",{className:"aim-video-selection-list",children:t.map(n=>s.jsxs("div",{className:"aim-video-selection-item hoverable "+(n.clipId===e.clipId?"aim-video-selection-item-selected":""),onClick:()=>i(n.clipId),children:[e.clipId===n.clipId?s.jsx("div",{className:"aim-video-selection-item-selected-indicator",children:"selected"}):null,s.jsx("div",{className:"aim-video-selection-item-image",children:s.jsx("img",{src:n.image_url,alt:n.name})}),s.jsx("div",{className:"aim-video-selection-item-text",children:s.jsxs("div",{className:"aim-video-selection-item-text-name",children:["From ",n.name]})}),s.jsxs("div",{className:"aim-video-selection-item-times",children:[s.jsxs("div",{className:"aim-video-selection-item-times-duration",children:["Duration: ",s.jsx("span",{className:"time",children:x(n.end-n.start)})]}),s.jsx("div",{className:"aim-video-selection-item-times-timestamps",children:s.jsxs("span",{className:"time",children:[x(n.start)," - ",x(n.end)]})})]}),s.jsx("div",{className:"aim-video-selection-item-footer",children:n.clipId!==e.clipId?s.jsx("button",{className:"aim-video-selection-item-footer-button",children:"Watch Clip"}):null})]},n.clipId))})]})}function K({resources:e}){return s.jsxs("div",{className:"aim-resource-list-section section",children:[s.jsxs("header",{className:"section-header",children:[s.jsx("h3",{className:"video-selector-title",children:"Resources"}),s.jsx("p",{children:"Accompanying resources from the videos"})]}),s.jsx("div",{className:"aim-resource-list",children:e.map(i=>s.jsx("div",{children:s.jsx("a",{className:"hoverable",href:i.link,target:"_blank",rel:"noreferrer",children:s.jsx("span",{dangerouslySetInnerHTML:{__html:i.label}})})},i.link))})]})}function X({playerApi:e,videos:i,resources:t,selectedVideo:n}){const[a,d]=m.useState(n),[r,l]=m.useState([]),o=m.useMemo(()=>i.length?i.find(c=>c.clipId===a):i[0],[i,a]),y=m.useCallback(c=>{l(f=>[...f,c])},[l]);function p(c){d(c);const f=i.find(N=>N.clipId===c);f&&e.setCurrentVideo(f)}const h=m.useCallback(c=>{r.includes(c.detail.clipId)||(y(c.detail.clipId),G())},[r]);return m.useEffect(()=>(e.getPlayerEl().addEventListener("finishedVideo",h),()=>{e.getPlayerEl().removeEventListener("finishedVideo",h)}),[h]),m.useEffect(()=>{o&&e.setCurrentVideo(o)},[]),s.jsxs("div",{children:[o&&s.jsx("p",{children:o.summary}),s.jsxs("div",{className:"",children:[o&&s.jsx(W,{selectedVideo:o,setSelectedVideo:p,videos:i}),s.jsx(K,{resources:t})]}),s.jsx(b,{containerStyle:{top:"100px"},toastOptions:{className:"toast-toast"}})]})}function Y(e,i){R.createRoot(e).render(s.jsx(X,{...i}))}const A={heading:"You have completed the currated clip!",message:"Keep watching to go deeper and learn more about this topic."};function G(){M(()=>s.jsxs("div",{className:"toast-content",children:[s.jsx("div",{className:"toast-heading",children:A.heading}),s.jsx("div",{className:"toast-text",children:A.message})]}),{icon:"ðŸŽ‰",duration:5e3})}class J{constructor(){u(this,"loaded",!1);u(this,"playerApi")}shouldUse(){var i;return(i=window==null?void 0:window.aimVimeoPluginData)!=null&&i.AimClipPlayerData?"videos"in window.aimVimeoPluginData.AimClipPlayerData?!0:(console.error("no videos in window.aimVimeoPluginData.AimClipPlayerData"),!1):!1}init(){this.loadPlayer()}loadPlayer(){if(this.playerApi)return console.log("player already loaded"),this.playerApi;{const i=document.querySelector(".aim-clip-player iframe");if(!i)throw new Error("No iframe found");this.playerApi=new Q(i),this.loaded=!0,this.startPlugin()}}async startPlugin(){if(!this.loaded)throw new Error("Vimeo Plugin has not been properly loaded, need to call loadPlayer before startPlugin");this.mountApp()}mountApp(){var n,a;const i=document.createElement("div");i.id="aim-clip-player-app";const t=(a=(n=this.playerApi)==null?void 0:n.getPlayerEl())==null?void 0:a.closest(".wp-block-embed");if(!t)throw new Error("Could not find wrapper element");t.appendChild(i),Y(i,{playerApi:this.playerApi,intro:window.aimVimeoPluginData.AimClipPlayerData.intro,videos:window.aimVimeoPluginData.AimClipPlayerData.videos,selectedVideo:window.aimVimeoPluginData.AimClipPlayerData.selectedVideo,resources:window.aimVimeoPluginData.AimClipPlayerData.resources})}}var g,I;class Q{constructor(i){V(this,g);u(this,"player");u(this,"currentVideo");this.playerEl=i,this.player=new P(this.playerEl)}getPlayerEl(){return this.playerEl}async setCurrentVideo(i){const t=this.playerEl.parentElement;await this.player.destroy(),this.player.off("timeupdate"),t.prepend(this.playerEl),this.player=new P(this.playerEl),this.currentVideo=i,await this.player.loadVideo(this.currentVideo.vimeoId),await this.setCurrentTime(),E(this,g,I).call(this)}async setCurrentTime(){var i;await this.player.setCurrentTime(((i=this.currentVideo)==null?void 0:i.start)??0)}}g=new WeakSet,I=function(){setTimeout(()=>{this.player.on("timeupdate",i=>{this.currentVideo&&this.currentVideo.end<=i.seconds&&this.playerEl.dispatchEvent(new CustomEvent("finishedVideo",{detail:this.currentVideo}))})},100)};window.aimVimeoPlugins||(window.aimVimeoPlugins=[]);window.aimVimeoPlugins.push({aimClipPlayer:new J});T();
