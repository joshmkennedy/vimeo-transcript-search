var C=Object.defineProperty;var g=i=>{throw TypeError(i)};var N=(i,e,s)=>e in i?C(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var r=(i,e,s)=>N(i,typeof e!="symbol"?e+"":e,s),A=(i,e,s)=>e.has(i)||g("Cannot "+s);var y=(i,e,s)=>e.has(i)?g("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,s);var V=(i,e,s)=>(A(i,e,"access private method"),s);import{j as t,f as h,c as D,r as l,O as b,V as I,P as k}from"./format-time-qBXqTqcc.js";function S({selectedVideo:i,setSelectedVideo:e,videos:s}){return t.jsx("div",{children:t.jsx("div",{className:"aim-video-selection-list",children:s.map(a=>t.jsxs("div",{className:"aim-video-selection-item",onClick:()=>e(a.clipId),children:[t.jsx("div",{className:"aim-video-selection-item-image",children:t.jsx("img",{src:a.image_url,alt:a.name})}),t.jsx("div",{className:"aim-video-selection-item-text",children:t.jsxs("div",{className:"aim-video-selection-item-text-name",children:["From ",a.name]})}),t.jsxs("div",{className:"aim-video-selection-item-times",children:[t.jsxs("div",{className:"aim-video-selection-item-times-duration",children:["Duration: ",t.jsx("span",{className:"time",children:h(a.end-a.start)})]}),t.jsx("div",{className:"aim-video-selection-item-times-timestamps",children:t.jsxs("span",{className:"time",children:[h(a.start)," - ",h(a.end)]})})]}),t.jsx("div",{className:"aim-video-selection-item-footer",children:t.jsx("button",{className:"aim-video-selection-item-footer-button",children:"Watch"})})]},a.clipId))})})}function T({resources:i}){return t.jsx("div",{className:"aim-resource-list",children:i.map(e=>t.jsx("div",{children:t.jsx("a",{className:"",href:e.link,target:"_blank",rel:"noreferrer",children:t.jsx("span",{dangerouslySetInnerHTML:{__html:e.label}})})},e.link))})}function L({playerApi:i,videos:e,resources:s,selectedVideo:a}){const[o,v]=l.useState(a),[p,f]=l.useState([]),d=l.useMemo(()=>e.length?e.find(n=>n.clipId===o):e[0],[e,o]);console.log("re-rendered",e,p.length);const P=l.useCallback(n=>{f(c=>[...c,n])},[f]);function j(n){v(n);const c=e.find(E=>E.clipId===n);c&&i.setCurrentVideo(c)}const u=l.useCallback(n=>{p.includes(n.detail.clipId)||(P(n.detail.clipId),_())},[p]);return l.useEffect(()=>(console.log("adding event listener"),i.getPlayerEl().addEventListener("finishedVideo",u),()=>{console.log("removing event listener"),i.getPlayerEl().removeEventListener("finishedVideo",u)}),[u]),l.useEffect(()=>{d&&i.setCurrentVideo(d)},[]),t.jsxs("div",{children:[t.jsxs("div",{className:"",children:[d&&t.jsx(S,{selectedVideo:d,setSelectedVideo:j,videos:e}),t.jsx(T,{resources:s})]}),t.jsx(b,{containerStyle:{top:"100px"},toastOptions:{className:"toast-toast"}})]})}function R(i,e){D.createRoot(i).render(t.jsx(L,{...e}))}const x={heading:"You have completed the currated clip!",message:"Keep watching to go deeper and learn more about this topic."};function _(){I(()=>t.jsxs("div",{className:"toast-content",children:[t.jsx("div",{className:"toast-heading",children:x.heading}),t.jsx("div",{className:"toast-text",children:x.message})]}),{icon:"ðŸŽ‰",duration:5e3})}class F{constructor(){r(this,"loaded",!1);r(this,"playerApi")}shouldUse(){var e;return(e=window==null?void 0:window.aimVimeoPluginData)!=null&&e.AimClipPlayerData?"videos"in window.aimVimeoPluginData.AimClipPlayerData?!0:(console.error("no videos in window.aimVimeoPluginData.AimClipPlayerData"),!1):!1}init(){console.log("Starting the skip to clip plugin"),this.loadPlayer()}loadPlayer(){if(this.playerApi)return console.log("player already loaded"),this.playerApi;{const e=document.querySelector(".aim-clip-player iframe");if(!e)throw new Error("No iframe found");this.playerApi=new M(e),this.loaded=!0,this.startPlugin()}}async startPlugin(){if(!this.loaded)throw new Error("Vimeo Plugin has not been properly loaded, need to call loadPlayer before startPlugin");console.log("trying to mount app"),this.mountApp()}mountApp(){var a,o;const e=document.createElement("div");e.id="aim-clip-player-app";const s=(o=(a=this.playerApi)==null?void 0:a.getPlayerEl())==null?void 0:o.closest(".wp-block-embed");if(!s)throw new Error("Could not find wrapper element");s.appendChild(e),console.log("App is now mounting"),R(e,{playerApi:this.playerApi,videos:window.aimVimeoPluginData.AimClipPlayerData.videos,selectedVideo:window.aimVimeoPluginData.AimClipPlayerData.selectedVideo,resources:window.aimVimeoPluginData.AimClipPlayerData.resources})}}var m,w;class M{constructor(e){y(this,m);r(this,"player");r(this,"currentVideo");this.playerEl=e,this.player=new k(this.playerEl),this.player.on("loaded",()=>{this.currentVideo&&(console.log("player loaded",this),setTimeout(()=>{this.currentVideo&&this.player.setCurrentTime(this.currentVideo.start).then(console.log).catch(console.error)},500))}),this.player.on("timeupdate",s=>{this.currentVideo&&this.currentVideo.end<=s.seconds&&this.playerEl.dispatchEvent(new CustomEvent("finishedVideo",{detail:this.currentVideo}))})}getPlayerEl(){return this.playerEl}setCurrentVideo(e){this.currentVideo=e,this.playerEl.setAttribute("src",`https://player.vimeo.com/video/${e.vimeoId}`),V(this,m,w).call(this)}}m=new WeakSet,w=function(){setTimeout(()=>{this.currentVideo&&this.player.setCurrentTime(this.currentVideo.start)},500)};window.aimVimeoPlugins||(window.aimVimeoPlugins=[]);window.aimVimeoPlugins.push({aimClipPlayer:new F});
